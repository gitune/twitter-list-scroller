# twitter-list-scroller
Firefox add-on for Twitter/X list automatic scroller

## これは何？

Twitter/Xのリストをホームタイムラインのタブにピン止めして使っている場合に、各リストの既読点(最後に閲覧していた地点)を覚えておき、タブ切り替え時に既読点まで自動的にスクロールしてくれるようにするFirefox機能拡張(add-on)です。PC browser版とAndroid版で動作確認しています。

## 使い方

公式の機能拡張として広く公開できるほど汎用的な作りにはできない気がしたので、あくまでも自分用として作成・利用しています。なので、実際に利用するにはそれなりに手間がかかります。

Firefoxの場合、設定中のAdd-on debuggingからローカルにあるadd-onを一時的に読み込んで使うことはできます(このリポジトリにあるmanifest.json、content_script.jsを同じディレクトリにダウンロードしておき、そのmanifest.jsonを指定して読み込む)が、Firefoxを再起動するたびに読み込まねばならず面倒です。ローカルにあるファイルから読み込むにせよ、永続的に使えるadd-onとするためには、Firefox公式の[アドオン開発センター](https://addons.mozilla.org/ja/developers/)に登録し署名を打ってもらう必要があります。Firefox Syncに登録済みであれば同じアカウントが使えます。

開発センターへのユーザー登録を行ったあと、manifest.jsonとcontent_script.jsをそれぞれroot directoryへ格納したzip fileを作成して「新しいアドオンを登録」すればあと少し。なおadd-onを登録する際に、公式のadd-onストアで公開したいか、それともclosedに使いたいだけかを選択する場面がありますので、closedに使いたいだけであれば後者を選びましょう。また登録時には他にも動作プラットフォームやcode generatorの類は使っていないか？などの質問がありますので適宜答えます。

アドオンを登録すると審査フェーズとなりますが、今回のものくらい小さなアドオンの場合はMachine screeningで3分くらいで承認されるものと思います。承認済みとなれば、自分のアドオン→すべてのバージョン付近からxpi fileがダウンロードできますので、そちらをダウンロードしてFirefoxへインストールすれば使えます。

機能拡張としてインストール、有効化されれば、あとはTwitter/Xを開けば勝手に動作します。時々誤動作することもあるでしょうがご勘弁あれ。

## 動作解説

* スクロールの検知、既読点の認識は定番のIntersectionObserverを利用しています。また同様にタブの切り替えなどはMutationObserverで。
* 既読点の記録は、主にツイートの時刻によって行っています。またIDも併用しています。
  * こうすることにより最後に見ていたツイートが削除されてしまったようなケースでもそれなりに動作します。
  * ただし、Twitter/XのDOM構造からはリツイートされたつぶやきに関しては元ツイートの時刻は取れるもののリツイート時間は取れないこと、また現在のTwitter/Xのタイムラインではスレッド化されたツイートでは(時系列的には古い)親ツイートも一緒に表示されること、さらに最近リストでもプロモーションが表示されるようになっていることから、それらについては時刻は取得しない(プロモーションについてはIDも取らない)、という処理を行っています。ちなみにそもそもプロモーションからは時刻情報が取れないようです。あとこれらの除外対象を識別する情報がDOMには存在しておらず(Twitter/XのDOMはおそらくスクレイピング対策のために難読化もされているし情報も非常に限られたものしか含まれておらず、非常に使いづらいです)、そのためとても場当たり的で脆弱な方法で認識しています。なので、もしある日突然動作がおかしくなった、という場合はおそらく、Twitter/X側のDOM構造が変わり、このあたりの判定がうまくいかなくなった、ということだろう、と思っていただければと。
* 自分でもAndroid端末で利用しているため、可能な限り無駄なCPUを使わないように気を付けましたが、やはりそれなりに処理量はあるためバッテリーには確実に影響ありそうです。
* なお多言語対応や少しでも汎用化できないかと英語でのTwitter/Xの表示を確認してみたりしたんですが、そもそもプロモーションの表示方法が違っていたり単にマッチング文字列を変えればよい、というレベルではない変更が必要そうだったため早々にあきらめました。
* 既読点の保存には `storage.sync` を利用しているので同じアカウントでログインしていれば適宜同期されます…と言いたいところですが、残念ながらFirefox for Androidではまだ `storage.sync` での[同期機能が未実装](https://extensionworkshop.com/documentation/develop/differences-between-desktop-and-android-extensions/)です(単にlocalと同じように扱われる。2025年8月時点)。残念。

## 謝辞

Firefox add-onとしてのひな形や、基本的な処理の骨格作成についてはGemini 2.5 Pro/Flashおよびその後継に手伝ってもらいました。とても助かりました。
